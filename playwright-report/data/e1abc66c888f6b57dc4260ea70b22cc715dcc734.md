# Test info

- Name: Flashcard Generation >> should show validation error for too short text
- Location: C:\AI\10xDevs\10xCardsRepo\tests\e2e\generate-flashcards.spec.ts:135:3

# Error details

```
TimeoutError: page.waitForSelector: Timeout 30000ms exceeded.
Call log:
  - waiting for locator('text="Text must be at least 2000 characters long"') to be visible

    at C:\AI\10xDevs\10xCardsRepo\tests\e2e\generate-flashcards.spec.ts:152:50
```

# Page snapshot

```yaml
- main:
    - text: 10xCards test@test.com
    - button "Logout"
    - heading "Generate Flashcards" [level=1]
    - heading "Enter Your Text" [level=2]
    - text: 26/10000 characters
    - textbox "Paste your text here (minimum 100 characters)": To jest zbyt krótki tekst.
    - combobox: gpt-4o-mini
    - button "Generate Flashcards" [disabled]
- region "Notifications alt+T"
```

# Test source

```ts
   52 |     let retries = 3;
   53 |     let waitTime = 2000; // Start with 2s wait
   54 |
   55 |     while (retries > 0) {
   56 |       try {
   57 |         await generateView.goto();
   58 |         // Wait for the page to be fully loaded and interactive
   59 |         await page.waitForLoadState("networkidle");
   60 |         const inputElement = await page.waitForSelector('[data-test-id="source-text-input"]', {
   61 |           state: "visible",
   62 |           timeout: 30000, // Increased timeout
   63 |         });
   64 |
   65 |         // Check if the element is actually visible in viewport
   66 |         const isVisible = await inputElement.isVisible();
   67 |         if (!isVisible) {
   68 |           throw new Error("Input element is not visible in viewport");
   69 |         }
   70 |         break;
   71 |       } catch (error) {
   72 |         console.log(`Navigation retry attempt ${4 - retries}, error:`, error);
   73 |         retries--;
   74 |         if (retries === 0) throw error;
   75 |         await page.waitForTimeout(waitTime);
   76 |         waitTime *= 2; // Exponential backoff
   77 |       }
   78 |     }
   79 |   });
   80 |
   81 |   test("should successfully generate flashcards from Polish text", async () => {
   82 |     // 1. Sprawdź początkowy stan
   83 |     await generateView.page.waitForLoadState("networkidle");
   84 |     const initialState = await generateView.getCurrentState();
   85 |     expect(initialState.flashcardsCount).toBe(0);
   86 |     expect(initialState.characterCount).toBe(0);
   87 |
   88 |     // 2. Wprowadź tekst i sprawdź licznik znaków
   89 |     await generateView.textInputSection.enterSourceText(samplePolishText);
   90 |     await generateView.page.waitForTimeout(1000); // Wait for character count to update
   91 |     const stateAfterText = await generateView.getCurrentState();
   92 |     expect(stateAfterText.characterCount).toBeGreaterThanOrEqual(2000);
   93 |
   94 |     // 3. Sprawdź czy przycisk generowania jest aktywny
   95 |     await generateView.page.waitForSelector('[data-test-id="generate-button"]:not([disabled])', {
   96 |       timeout: 30000, // Increased timeout
   97 |     });
   98 |     expect(await generateView.isReadyForGeneration()).toBe(true);
   99 |
  100 |     // 4. Wygeneruj fiszki
  101 |     await generateView.generateFlashcardsFromText(samplePolishText);
  102 |
  103 |     // 5. Sprawdź czy fiszki zostały wygenerowane (z retry logic)
  104 |     let flashcardsGenerated = false;
  105 |     for (let i = 0; i < 3; i++) {
  106 |       const stateAfterGeneration = await generateView.getCurrentState();
  107 |       if (stateAfterGeneration.flashcardsCount > 0) {
  108 |         flashcardsGenerated = true;
  109 |         break;
  110 |       }
  111 |       await generateView.page.waitForTimeout(10000); // Increased wait time between checks
  112 |     }
  113 |     expect(flashcardsGenerated).toBe(true);
  114 |
  115 |     // 6. Zapisz wszystkie wygenerowane fiszki
  116 |     await generateView.flashcardsList.saveAllFlashcards();
  117 |
  118 |     // 7. Sprawdź końcowy stan z explicit wait i upewnij się, że komunikat jest widoczny
  119 |     const successMessage = await generateView.page.waitForSelector(
  120 |       'text="All flashcards saved successfully!"',
  121 |       {
  122 |         state: "visible",
  123 |         timeout: 30000, // Increased timeout
  124 |       },
  125 |     );
  126 |
  127 |     // Sprawdź czy komunikat jest faktycznie widoczny w viewport
  128 |     const isSuccessMessageVisible = await successMessage.isVisible();
  129 |     expect(isSuccessMessageVisible).toBe(true);
  130 |
  131 |     const finalState = await generateView.getCurrentState();
  132 |     expect(finalState.flashcardsCount).toBe(0);
  133 |   });
  134 |
  135 |   test("should show validation error for too short text", async () => {
  136 |     // 1. Sprawdź początkowy stan
  137 |     await generateView.page.waitForLoadState("networkidle");
  138 |     const initialState = await generateView.getCurrentState();
  139 |     expect(initialState.flashcardsCount).toBe(0);
  140 |     expect(initialState.characterCount).toBe(0);
  141 |
  142 |     // 2. Wprowadź krótki tekst
  143 |     const shortText = "To jest zbyt krótki tekst.";
  144 |     await generateView.textInputSection.enterSourceText(shortText);
  145 |
  146 |     // 3. Poczekaj na aktualizację stanu
  147 |     await generateView.page.waitForTimeout(1000); // Wait for character count to update
  148 |     const stateAfterText = await generateView.getCurrentState();
  149 |     expect(stateAfterText.characterCount).toBe(26);
  150 |
  151 |     // Wait for validation error to appear and be visible
> 152 |     const errorMessage = await generateView.page.waitForSelector(
      |                                                  ^ TimeoutError: page.waitForSelector: Timeout 30000ms exceeded.
  153 |       'text="Text must be at least 2000 characters long"',
  154 |       {
  155 |         state: "visible",
  156 |         timeout: 30000, // Increased timeout
  157 |       },
  158 |     );
  159 |
  160 |     // Sprawdź czy komunikat błędu jest faktycznie widoczny w viewport
  161 |     const isErrorMessageVisible = await errorMessage.isVisible();
  162 |     expect(isErrorMessageVisible).toBe(true);
  163 |
  164 |     expect(stateAfterText.validationErrors).toContain("Text must be at least 2000 characters long");
  165 |
  166 |     // 4. Sprawdź czy przycisk generowania jest wyłączony
  167 |     await generateView.page.waitForSelector('[data-test-id="generate-button"][disabled]', {
  168 |       timeout: 30000, // Increased timeout
  169 |     });
  170 |     expect(await generateView.isReadyForGeneration()).toBe(false);
  171 |
  172 |     // 5. Sprawdź czy licznik znaków pokazuje błąd
  173 |     const characterCount = await generateView.page.locator('[data-test-id="character-count"]');
  174 |     await expect(characterCount).toHaveText("26/10000 characters");
  175 |     await expect(characterCount).toHaveClass(/text-red-600/);
  176 |
  177 |     // 6. Sprawdź czy nie można wygenerować fiszek
  178 |     try {
  179 |       await generateView.generateFlashcardsFromText(shortText);
  180 |       throw new Error("Should not be able to generate flashcards from short text");
  181 |     } catch (error: unknown) {
  182 |       if (error instanceof Error) {
  183 |         expect(error.message).toBe("Generate button is disabled");
  184 |       } else {
  185 |         throw error;
  186 |       }
  187 |     }
  188 |
  189 |     // 7. Sprawdź końcowy stan - nie powinno być żadnych fiszek
  190 |     await generateView.page.waitForTimeout(1000); // Give time for any potential state changes
  191 |     const finalState = await generateView.getCurrentState();
  192 |     expect(finalState.flashcardsCount).toBe(0);
  193 |   });
  194 |
  195 |   test("should handle saving all generated flashcards", async () => {
  196 |     // 1. Wygeneruj fiszki
  197 |     await generateView.page.waitForLoadState("networkidle");
  198 |     await generateView.generateFlashcardsFromText(samplePolishText);
  199 |
  200 |     // 2. Sprawdź stan przed zapisaniem (z retry logic)
  201 |     let flashcardsGenerated = false;
  202 |     for (let i = 0; i < 3; i++) {
  203 |       const stateBeforeSave = await generateView.getCurrentState();
  204 |       if (stateBeforeSave.flashcardsCount > 0) {
  205 |         flashcardsGenerated = true;
  206 |         break;
  207 |       }
  208 |       await generateView.page.waitForTimeout(10000); // Increased wait time between checks
  209 |     }
  210 |     expect(flashcardsGenerated).toBe(true);
  211 |
  212 |     // 3. Zapisz wszystkie wygenerowane fiszki
  213 |     await generateView.flashcardsList.saveAllFlashcards();
  214 |
  215 |     // 4. Sprawdź czy lista została wyczyszczona i pojawił się komunikat o sukcesie
  216 |     const successMessage = await generateView.page.waitForSelector(
  217 |       'text="All flashcards saved successfully!"',
  218 |       {
  219 |         state: "visible",
  220 |         timeout: 30000, // Increased timeout
  221 |       },
  222 |     );
  223 |
  224 |     // Sprawdź czy komunikat jest faktycznie widoczny w viewport
  225 |     const isSuccessMessageVisible = await successMessage.isVisible();
  226 |     expect(isSuccessMessageVisible).toBe(true);
  227 |
  228 |     const stateAfterSave = await generateView.getCurrentState();
  229 |     expect(stateAfterSave.flashcardsCount).toBe(0);
  230 |   });
  231 | });
  232 |
```
